<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
    />
    <title>S0LACE • Player</title>

    <link rel="shortcut icon" content="favicon.ico" />
    <link rel="stylesheet" href="index.css" />

    <!-- Scramjet stack: SAME AS HOME -->
    <script src="/scram/scramjet.all.js"></script>
    <script src="baremux/index.js" defer></script>
    <script src="epoxy/index.js" defer></script>
    <script src="register-sw.js" defer></script>
    <script src="search.js" defer></script>
    <script src="index.js" defer></script>

    <!-- global settings / tab cloak -->
    <script src="global-hub.js" defer></script>
  </head>

  <body>
    <header class="site-header">
      <div class="site-title">
        S0LACE
        <span>media player</span>
      </div>
      <nav class="site-nav">
        <a href="index.html">Home</a>
        <a href="games.html">Games</a>
        <a href="media.html" class="active">Media</a>
        <a href="apps.html">Apps</a>
        <a href="settings.html">Settings</a>
      </nav>
    </header>

    <main class="player-main">
      <div class="player-info">
        <div class="player-left">
          <span id="player-title">Loading media…</span>
        </div>
        <div class="player-actions">
          <button id="btn-reload" type="button">RELOAD</button>
          <button id="btn-full" type="button">FULLSCREEN</button>
          <a id="btn-open" href="#" target="_blank" rel="noopener noreferrer">
            OPEN TAB
          </a>
          <a href="media.html">BACK</a>
        </div>
      </div>

      <div class="player-frame-wrap">
        <iframe id="media-frame" src="" allowfullscreen></iframe>
      </div>
    </main>

    <script>
      const params = new URLSearchParams(location.search);
      const rawSrc = params.get("src") || "";
      const title = params.get("title") || "Untitled";

      const frame = document.getElementById("media-frame");
      const titleEl = document.getElementById("player-title");
      const openLink = document.getElementById("btn-open");
      const reloadBtn = document.getElementById("btn-reload");
      const fullBtn = document.getElementById("btn-full");

      titleEl.textContent = title;

      if (rawSrc) {
        // rawSrc already contains /scramjet/... from media.html
        frame.src = rawSrc;
        if (openLink) openLink.href = rawSrc;
      } else {
        const msg = document.createElement("div");
        msg.className = "no-src";
        msg.textContent = "No media source provided. Go back and pick something.";
        frame.replaceWith(msg);
      }

      // reload the iframe
      reloadBtn?.addEventListener("click", () => {
        if (!frame) return;
        try {
          if (frame.contentWindow) {
            frame.contentWindow.location.reload();
          } else {
            frame.src = frame.src;
          }
        } catch {
          frame.src = frame.src;
        }
      });

      // fullscreen toggle
      fullBtn?.addEventListener("click", () => {
        if (!frame) return;
        if (frame.requestFullscreen) frame.requestFullscreen();
        else if (frame.webkitRequestFullscreen) frame.webkitRequestFullscreen();
      });
    </script>
  </body>
</html>
