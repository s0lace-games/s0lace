<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
    />
    <title>Scramjet Settings</title>

    <link rel="shortcut icon" href="favicon.webp" />
    <link rel="stylesheet" href="index.css" />
    <script src="global-hub.js" defer></script>


    <style>
      :root {
        --bg: #050814;
        --panel: #020617;
        --fg: #f9fafb;
        --fg-dim: #9ca3af;
        --accent: #3b82f6;
        --accent-soft: rgba(37, 99, 235, 0.3);
        --border-subtle: rgba(148, 163, 184, 0.25);
        --header-h: 56px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: radial-gradient(circle at top, #0b1220 0, #020617 55%, #000 100%);
        color: var(--fg);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }

      /* HEADER */
      .site-header {
        position: sticky;
        top: 0;
        z-index: 50;
        height: var(--header-h);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 18px;
        background: rgba(3, 7, 18, 0.9);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(148, 163, 184, 0.1);
      }

      .site-title {
        font-size: 15px;
        font-weight: 600;
      }

      .site-title span {
        opacity: 0.6;
        font-weight: 400;
        font-size: 12px;
        margin-left: 4px;
      }

      .site-nav {
        display: flex;
        gap: 10px;
        font-size: 13px;
      }

      .site-nav a {
        text-decoration: none;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid transparent;
        color: var(--fg-dim);
        cursor: pointer;
        transition: 0.15s ease;
      }

      .site-nav a:hover {
        border-color: rgba(148, 163, 184, 0.4);
        color: var(--fg);
        background: rgba(15, 23, 42, 0.8);
      }

      .site-nav a.active {
        border-color: rgba(59, 130, 246, 0.8);
        background: rgba(37, 99, 235, 0.35);
        color: var(--fg);
      }

      main {
        padding: 24px 16px 32px;
        max-width: 800px;
        margin: 0 auto;
      }

      h1 {
        font-size: 22px;
        margin-bottom: 6px;
      }

      .sub {
        font-size: 13px;
        color: var(--fg-dim);
        margin-bottom: 20px;
      }

      .settings-group {
        background: rgba(15, 23, 42, 0.95);
        border-radius: 16px;
        border: 1px solid var(--border-subtle);
        padding: 16px 16px 14px;
        margin-bottom: 16px;
      }

      .settings-title {
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 10px;
      }

      .settings-help {
        font-size: 12px;
        color: var(--fg-dim);
        margin-bottom: 12px;
      }

      .settings-row {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 10px;
        font-size: 13px;
      }

      .settings-row label {
        font-size: 13px;
        color: var(--fg-dim);
        min-width: 90px;
      }

      .settings-row input[type="text"],
      .settings-row input[type="url"],
      .settings-row select {
        flex: 1;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: #020617;
        color: var(--fg);
        font-size: 13px;
        outline: none;
      }

      .settings-row input::placeholder {
        color: #6b7280;
      }

      .settings-row select {
        cursor: pointer;
      }

      .btn-pill {
        padding: 5px 12px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.8);
        background: transparent;
        color: var(--fg-dim);
        font-size: 12px;
        cursor: pointer;
        white-space: nowrap;
      }

      .btn-pill:hover {
        background: var(--accent-soft);
        color: var(--fg);
        border-color: rgba(59, 130, 246, 0.9);
      }

      .btn-pill.primary {
        background: var(--accent-soft);
        color: var(--fg);
        border-color: rgba(59, 130, 246, 0.9);
      }

      .btn-pill.primary.inactive {
        opacity: 0.6;
        background: transparent;
        border-color: rgba(148, 163, 184, 0.8);
        color: var(--fg-dim);
      }

      .theme-toggle {
        display: inline-flex;
        padding: 3px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.7);
      }

      .theme-toggle button {
        border: none;
        background: transparent;
        padding: 5px 12px;
        border-radius: 999px;
        font-size: 12px;
        color: var(--fg-dim);
        cursor: pointer;
      }

      .theme-toggle button.active {
        background: var(--accent-soft);
        color: var(--fg);
      }

      .settings-footer-note {
        font-size: 11px;
        color: var(--fg-dim);
        margin-top: 6px;
      }

      /* LIGHT THEME OVERRIDES FOR THIS PAGE */
      body.theme-light {
        background: #f3f4f6;
        color: #020617;
      }

      body.theme-light .site-header {
        background: rgba(249, 250, 251, 0.9);
        border-bottom: 1px solid rgba(148, 163, 184, 0.6);
      }

      body.theme-light .site-title span {
        color: #6b7280;
      }

      body.theme-light .site-nav a {
        color: #4b5563;
      }

      body.theme-light .site-nav a.active {
        background: rgba(37, 99, 235, 0.12);
        border-color: rgba(59, 130, 246, 0.9);
        color: #111827;
      }

      body.theme-light .settings-group {
        background: #ffffff;
        border-color: rgba(148, 163, 184, 0.6);
      }

      body.theme-light .settings-row input[type="text"],
      body.theme-light .settings-row input[type="url"],
      body.theme-light .settings-row select {
        background: #f9fafb;
        color: #111827;
        border-color: rgba(148, 163, 184, 0.9);
      }

      body.theme-light .settings-row input::placeholder {
        color: #9ca3af;
      }

      body.theme-light .btn-pill {
        color: #374151;
        border-color: rgba(148, 163, 184, 0.9);
      }

      body.theme-light .btn-pill.primary {
        background: rgba(37, 99, 235, 0.12);
        color: #1f2937;
      }

      body.theme-light .theme-toggle {
        background: #f9fafb;
        border-color: rgba(148, 163, 184, 0.9);
      }

      body.theme-light .theme-toggle button {
        color: #4b5563;
      }

      body.theme-light .theme-toggle button.active {
        background: rgba(37, 99, 235, 0.16);
        color: #111827;
      }
    </style>
  </head>

  <body>
    <header class="site-header">
      <div class="site-title">
        Scramjet Hub <span>settings</span>
      </div>
      <nav class="site-nav">
        <a href="index.html">Proxy</a>
        <a href="games.html">Games</a>
        <a href="chat.html">Chat</a>
        <a href="settings.html" class="active">Settings</a>
      </nav>
    </header>

    <main>
      <h1>Settings</h1>
      <p class="sub">
        Tab cloaking and appearance. Values are stored in this browser using localStorage.
      </p>

      <!-- TAB CLOAKING -->
      <div class="settings-group">
        <div class="settings-title">Tab Cloaking</div>
        <div class="settings-help">
          Change how this tab looks in the browser bar. Presets work instantly. Custom lets you set
          your own title and favicon URL.
        </div>

        <div class="settings-row">
          <label for="cloak-preset">Preset</label>
          <select id="cloak-preset">
            <option value="default">Scramjet (default)</option>
            <option value="gdocs">Google Docs</option>
            <option value="gclass">Google Classroom</option>
            <option value="gdrive">Google Drive</option>
            <option value="khan">Khan Academy</option>
            <option value="custom">Custom</option>
          </select>
        </div>

        <div class="settings-row">
          <label for="cloak-title">Custom title</label>
          <input
            type="text"
            id="cloak-title"
            placeholder="e.g. Untitled document - Google Docs"
          />
        </div>

        <div class="settings-row">
          <label for="cloak-favicon">Custom favicon</label>
          <input
            type="url"
            id="cloak-favicon"
            placeholder="https://example.com/favicon.ico"
          />
        </div>

        <div class="settings-row" style="justify-content: flex-end;">
          <button type="button" class="btn-pill primary" id="cloak-apply">
            Apply cloaking
          </button>
        </div>

        <div class="settings-footer-note">
          This only affects this hub. Other pages have to include the same logic if you want global cloaking.
        </div>
      </div>

      <!-- THEME -->
      <div class="settings-group">
        <div class="settings-title">Appearance</div>
        <div class="settings-help">
          Light or dark mode. Stored per browser. Other hub pages can read the same setting if they look at
          <code>localStorage.sjTheme</code>.
        </div>

        <div class="settings-row" style="justify-content: space-between;">
          <label>Theme</label>
          <div class="theme-toggle">
            <button type="button" id="theme-dark">Dark</button>
            <button type="button" id="theme-light">Light</button>
          </div>
        </div>
      </div>
    </main>

    <script>
      // ---------- TAB CLOAKING ----------

      const TAB_PRESETS = {
        default: {
          label: "Scramjet (default)",
          title: "Scramjet Hub",
          favicon: "favicon.webp",
        },
        gdocs: {
          label: "Google Docs",
          title: "Untitled document - Google Docs",
          favicon:
            "https://ssl.gstatic.com/docs/doclist/images/drive_icon_16.png",
        },
        gclass: {
          label: "Google Classroom",
          title: "Classes",
          favicon: "https://ssl.gstatic.com/classroom/favicon.png",
        },
        gdrive: {
          label: "Google Drive",
          title: "My Drive - Google Drive",
          favicon:
            "https://ssl.gstatic.com/docs/doclist/images/drive_16.png",
        },
        khan: {
          label: "Khan Academy",
          title: "Dashboard | Khan Academy",
          favicon: "https://cdn.kastatic.org/images/favicon.ico",
        },
      };

      function getFaviconLinks() {
        const links = Array.from(
          document.querySelectorAll(
            'link[rel="icon"], link[rel="shortcut icon"]'
          )
        );
        if (links.length > 0) return links;

        // If nothing exists, create one
        const link = document.createElement("link");
        link.rel = "icon";
        document.head.appendChild(link);
        return [link];
      }

      function applyTabCloak({ mode, presetKey, title, favicon }) {
        // Save to localStorage
        if (mode) localStorage.setItem("sjTabMode", mode);
        if (presetKey) localStorage.setItem("sjTabPreset", presetKey);
        if (title !== undefined) localStorage.setItem("sjTabTitle", title);
        if (favicon !== undefined)
          localStorage.setItem("sjTabFavicon", favicon);

        // Resolve final values
        let finalTitle = title;
        let finalFavicon = favicon;

        if (mode === "preset" && presetKey && TAB_PRESETS[presetKey]) {
          finalTitle = TAB_PRESETS[presetKey].title;
          finalFavicon = TAB_PRESETS[presetKey].favicon;
        } else if (mode === "custom") {
          // If custom but nothing entered, do not apply empty
          if (!finalTitle) {
            finalTitle = document.title || "Scramjet Hub";
          }
        }

        if (finalTitle) {
          document.title = finalTitle;
        }

        if (finalFavicon) {
          const links = getFaviconLinks();
          links.forEach((l) => (l.href = finalFavicon));
        }
      }

      function initTabCloakUI() {
        const presetSelect = document.getElementById("cloak-preset");
        const titleInput = document.getElementById("cloak-title");
        const favInput = document.getElementById("cloak-favicon");
        const applyBtn = document.getElementById("cloak-apply");

        const savedMode = localStorage.getItem("sjTabMode") || "preset";
        const savedPreset =
          localStorage.getItem("sjTabPreset") || "default";
        const savedTitle = localStorage.getItem("sjTabTitle") || "";
        const savedFav = localStorage.getItem("sjTabFavicon") || "";

        // Init UI from saved values
        presetSelect.value = savedMode === "custom" ? "custom" : savedPreset;
        if (savedMode === "custom") {
          titleInput.value = savedTitle;
          favInput.value = savedFav;
        }

        // Apply on load
        if (savedMode === "custom") {
          applyTabCloak({
            mode: "custom",
            title: savedTitle,
            favicon: savedFav,
          });
        } else {
          applyTabCloak({
            mode: "preset",
            presetKey: savedPreset,
          });
        }

        // When preset changes
        presetSelect.addEventListener("change", () => {
          const val = presetSelect.value;
          if (val === "custom") {
            applyTabCloak({
              mode: "custom",
              title: titleInput.value.trim(),
              favicon: favInput.value.trim(),
            });
          } else {
            applyTabCloak({ mode: "preset", presetKey: val });
          }
        });

        // Apply custom button
        applyBtn.addEventListener("click", () => {
          const title = titleInput.value.trim();
          const fav = favInput.value.trim();
          applyTabCloak({
            mode: "custom",
            title,
            favicon: fav,
          });
          presetSelect.value = "custom";
        });
      }

      // ---------- THEME ----------

      function applyTheme(mode) {
        const body = document.body;
        const darkBtn = document.getElementById("theme-dark");
        const lightBtn = document.getElementById("theme-light");

        if (!mode) mode = "dark";

        if (mode === "light") {
          body.classList.add("theme-light");
        } else {
          body.classList.remove("theme-light");
        }

        localStorage.setItem("sjTheme", mode);

        if (darkBtn && lightBtn) {
          if (mode === "dark") {
            darkBtn.classList.add("active");
            lightBtn.classList.remove("active");
          } else {
            lightBtn.classList.add("active");
            darkBtn.classList.remove("active");
          }
        }
      }

      function initThemeUI() {
        const darkBtn = document.getElementById("theme-dark");
        const lightBtn = document.getElementById("theme-light");
        const saved = localStorage.getItem("sjTheme") || "dark";

        applyTheme(saved);

        if (darkBtn) {
          darkBtn.addEventListener("click", () => applyTheme("dark"));
        }
        if (lightBtn) {
          lightBtn.addEventListener("click", () => applyTheme("light"));
        }
      }

      // ---------- INIT ----------

      document.addEventListener("DOMContentLoaded", () => {
        initTabCloakUI();
        initThemeUI();
      });
    </script>
  </body>
</html>
