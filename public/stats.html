<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>S0LACE • Stats</title>

<link rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="index.css">
<script src="global-hub.js" defer></script>

<style>
main{padding:48px 32px;max-width:1000px;margin:auto}
.page-header h1{font-size:42px;margin-bottom:8px}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:18px;margin:32px 0}
.stat-box{padding:18px;border-radius:14px;background:rgba(255,255,255,.03);
border:1px solid rgba(255,255,255,.08);text-align:center}
.stat-label{font-family:"Press Start 2P";font-size:10px;color:var(--fg-dim)}
.stat-value{font-size:28px;color:var(--accent);margin-top:6px}

.list{margin-top:24px}
.list h2{font-size:18px;margin-bottom:12px}
.list-item{display:flex;justify-content:space-between;
padding:10px 14px;border-bottom:1px solid rgba(255,255,255,.06);
font-family:"Press Start 2P";font-size:10px}
</style>
</head>

<body>

<nav class="side-header">
  <a href="index.html" class="side-icon" data-icon="home"><img></a>
  <a href="games.html" class="side-icon" data-icon="games"><img></a>
  <a href="media.html" class="side-icon" data-icon="media"><img></a>
  <a href="settings.html" class="side-icon" data-icon="settings"><img></a>
</nav>

<main>

<div class="page-header">
  <h1>STATS</h1>
</div>

<!-- COUNTERS -->
<div class="stats-grid">
  <div class="stat-box">
    <div class="stat-label">TODAY</div>
    <div class="stat-value" id="vis-today">—</div>
  </div>
  <div class="stat-box">
    <div class="stat-label">THIS WEEK</div>
    <div class="stat-value" id="vis-week">—</div>
  </div>
  <div class="stat-box">
    <div class="stat-label">ALL TIME</div>
    <div class="stat-value" id="vis-all">—</div>
  </div>
</div>

<!-- COUNTRIES -->
<div class="list">
  <h2>COUNTRIES</h2>
  <div id="countries-list"></div>
</div>

<!-- REGIONS -->
<div class="list">
  <h2>REGIONS</h2>
  <div id="regions-list"></div>
</div>

</main>

<!-- SIDE ICON SYNC -->
<script>
function getAccent(){return localStorage.getItem("s0laceAccent")||"gray"}
function updateSideIcons(){
  document.querySelectorAll(".side-icon").forEach(a=>{
    const i=a.dataset.icon,img=a.querySelector("img");
    const act=location.pathname.endsWith(a.getAttribute("href"));
    a.classList.toggle("active",act);
    img.src=`thumbs/${i}/${act?getAccent():"gray"}.png`;
  });
}
updateSideIcons();
window.addEventListener("storage",updateSideIcons);
</script>

<!-- FIREBASE READ-ONLY STATS -->
<script type="module">
import { initializeApp,getApps } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase,ref,get } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const app = getApps().length
  ? getApps()[0]
  : initializeApp({
      apiKey:"AIzaSyBbgy76ThxHaKlOhpiLQ6Nw4ekR1b9t3DA",
      authDomain:"s0lace-web.firebaseapp.com",
      databaseURL:"https://s0lace-web-default-rtdb.firebaseio.com",
      projectId:"s0lace-web"
    });

const db=getDatabase(app);
const today=()=>new Date().toISOString().split("T")[0];
const week=()=>{
  const d=new Date(),j=new Date(d.getFullYear(),0,1);
  return"week_"+Math.ceil((((d-j)/86400000)+j.getDay()+1)/7);
};

async function loadStats(){
  const [a,t,w,countries,regions]=await Promise.all([
    get(ref(db,"visitors/all")),
    get(ref(db,"visitors/today/"+today())),
    get(ref(db,"visitors/week/"+week())),
    get(ref(db,"geo/countries")),
    get(ref(db,"geo/regions"))
  ]);

  vis-all.textContent=a.val()||0;
  vis-today.textContent=t.val()||0;
  vis-week.textContent=w.val()||0;

  renderList("countries-list",countries.val());
  renderList("regions-list",regions.val());
}

function renderList(id,data){
  const el=document.getElementById(id);
  el.innerHTML="";
  if(!data)return;
  Object.entries(data)
    .sort((a,b)=>b[1]-a[1])
    .slice(0,20)
    .forEach(([k,v])=>{
      const row=document.createElement("div");
      row.className="list-item";
      row.innerHTML=`<span>${k}</span><span>${v}</span>`;
      el.appendChild(row);
    });
}

loadStats();
</script>

</body>
</html>
